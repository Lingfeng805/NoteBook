# python FTP教程

- 开放式系统互联通信参考模型(Open System Interconnection Reference Model, OSI);
- OSI模型定义了网络互连的七层框架：**应用层、表示层、会话层、传输层、网络层、数据链路层、物理层**，每一层实现各自的功能和协议，并完成与相邻层的接口通信。

![image.png](E:/software/Typora/pictures/4f4a8944230a4e8ab165c480c8c0600dtplv-k3u1fbpfcp-watermark.awebp)

- **应用层**：提供为应用软件而设的接口，以设置与另一应用软件之间的通信。

  - 常用的应用层协议：

  | 协议   | 端口  |
  | ------ | ----- |
  | http   | 80    |
  | ftp    | 20/21 |
  | smtp   | 25    |
  | pop3   | 110   |
  | telnet | 23    |
  | dns    | 53    |

  - **主要功能**：
    - 【用户接口】：应用层是用户与网络，以及应用程序与网络间的直接接口，使得用户能够与网络进行交互联系。
    - 【实现各种服务】：改层具有的各种应用程序可以完成和实现用户请求的各种服务。

- **表示层**：*使通信的应用程序能够解释交换数据的含义*。提供一个可供应用层选择的服务的集合，使得应用层可以根据这些服务功能解释数据的含义。表示层以下各层只关心如何可靠地传输数据，而表示层关心的是所传输数据的表现方式、它的语法和语义。表示服务的例子有统一的数据编码、数据压缩格式和加密技术等。

  - 常见的表示层协议：Telnet、Rlogin、SNMP、Gopher
  - **主要功能**：
    - 数据的编码解码，加密解密，压缩和解压缩；
    - 进行格式兼容传输数据。

- **会话层**：*支持两个表示层实体之间的交互作用*。会话层不参与具体的传输，它提供包括访问验证和会话管理在内的建立和维护应用之间通信的机制。如服务器验证用户登录便是由会话层完成的。会话层提供了数据交换定界和同步功能，包括了建立检查点和恢复方案的方法。

  - 常见协议：SMTP.
  - **主要任务**：组织和协调两个会话进程之间的通信，并对数据交换进行管理。

- **传输层**：传输层建立了主机**端到端**的链接，传输层的作用是为上层协议提供端到端的可靠和透明的数据传输服务，包括处理差错控制和流量控制等问题。

  - 常见协议：TCP、UDP；
    - TCP和UDP：TCP/IP协议通信传输中的数据单位，一般也称为“数据包”。
    - 数据单元：是网络信息传输的基本单位。一般网络连接不允许传送任意大小的数据包，而是采用分组技术将一个数据分成若干个很小的数据包，并给每个小数据包加上一些关于此数据包的属性信息。
  - **主要功能**：会话的多路复用、数据的分段、流量控制。
  - **主要任务**：向用户提供可靠的端到端的差错和流量控制，保证报文的正确传输。

- **网络层**：该层的功能属于通信子网，通过网络连接交换传输层实体发出的数据。

  - 常见协议：IP、ICMP、ARP、RARP、AKP、UCC。
  - **主要功能**：IP编址和路由。
    - **IPv4**:即IP协议的第4个版本。互连网络协议IPv4用一个32位(4字节)的IP地址定义每个主机。IP地址的形式是由四组以点划分的十进制数，范围是0~255。
    - **IPv6**:即IP协议的第6个版本。IPv6把地址长度扩展至128位，共计3.4×$10^{38}$个地址，是IPv4地址空间($2^{32}$)的近1600亿倍（$2^{96}$）。
  - **主要任务**：数据链路层的数据在该层被转换为数据包，然后通过路径选择、分段组合、顺序、进/出路由等控制，将信息从一个网络设备传送到另一个网络设备。

- **数据链路层**：该层功能是建立、维持和释放网络实体之间的数据链路，这种数据链路对网络层表现为一条无差错的信道。

  - 常见协议：FDDI、Ethernet、Arpanet、PDN、SLIP、PPP、STP、HDLC、SDLC、帧中继、IEEE 802.1A，IEEE802.2到IEEE 802.
  - **具体工作**：接收来自物理层的位流(以比特流)形式的数据，通过差错控制等方式传到网络层；也将来自上层的数据帧，拆装为位流形式的数据转发到物理层；并且，还负责处理接收端发回的确认帧的信息，以便提供可靠的数据传输。
    - 帧：是数据链路层的传输单元。
  - **主要设备**：交换机，局域网(LAN)一般是通过交换机连接的。
    - 局域网：指在某一个区域内由多台计算机互联成的计算机组。局域网可以实现文件管理、应用软件共享、打印机共享、扫描仪共享、工作组内的日程安排、电子邮件和传真通信服务等功能。局域网是**封闭型**的，可以由办公室内的两台计算机组成，也可以由一个公司内的上千台计算机组成。

- **物理层**：建立、维护、断开物理连接。

  - 常见协议：IEEE 802.1A、IEEE 802.2到IEEE 802.11
  - **主要功能**：主要定义物理设备标准，如网线的接口类型、光纤的接口类型、各种传输介质的传输速率等。利于传输介质为数据链路层提供物理连接，实现比特流（即由1/0转化为电流强弱来进行传输，到达目的地后再转化为1/0）的**透明传输**。尽可能屏蔽掉具体传输介质和物理设备的差异。

**Linux操作系统下默认编码格式为‘utf-8';  windows操作系统下默认编码格式为’gbk‘**



## 粘包现象

- 只有TCP有粘包现象，UDP永远不会粘包。

![img](E:/software/Typora/pictures/1036857-20161210123107304-1582863963.png)



- **粘包现象**的底层逻辑：
  - 1.发送端（应用程序）通过**send( )**将数据直接发送给本地的**缓存**空间，至此发送端应用程序的任务完成；后续操作由发送端的操作系统完成(由应用层以下的四层协作完成，应用层无法控制了)；
  - 2.发送端的操作系统将发送端缓存中的数据传输给接收端的缓存，至此都是发送端的下四层和接收端的下四层在配合，此时数据存在于发送端和接收端的缓存中，接收端的应用程序尚未接收到数据；
  - 3.接收端（应用程序）通过**recv( )**告知接收端的缓存它要数据，至此接收端的缓存将数据交给接收端的应用程序，但此时也是**recv( )**一次要多少，缓存就给多少。如**recv(1024)**,表示缓存一次**最多**给到接收端(应用程序)1024个字节的数据，不管缓存中有多少数据(若缓存中大于1024则给1024个字节，若少于1024则能给多少给多少。)
  - 此时就可能出现了**粘包**，比如发送端第一次发送256个字节，那么接收端第一次接收肯定是接收256个字节(少于1024),此时没问题；但若发送端第二次发送了2056个字节,接收端第二次接收只能接收1024个字节(还剩1032个字节存在于缓存中未释放)；当发送端第三次再发送128个字节时，此时接收端并不会去接收这128个字节，而是继续去接收缓存中未释放第二次发来的1032个字节中的前1024个字节（还剩8个字节），当接收端第四次接收时才会接收（第二次剩余的8个字节+第三次发的128个字节），这便产生了**粘包现象**，发送端和接收端接收顺序已经完全乱套了。
  - 此外，发送端引起的粘包是由TCP协议本身造成的，TCP为提高传输效率，发送端往往要收集到足够多的数据后才发送一个TCP段。若连续几次需要send的数据都很少，通常TCP会根据优化算法将这些数据合成一个TCP段后一次发送出去，此时接收端就收到了粘包数据。即发送端发送的连续数据具有**数据量比较小、时间间隔比较短**的特点，发送端直接将这连续的几次send一次性发出去。
  - **粘包问题主要还是因为接收端不知道消息之间的界限，不知道一次性提取多少字节的数据所造成的**。
- 解决**粘包问题**：
  - 再发报头